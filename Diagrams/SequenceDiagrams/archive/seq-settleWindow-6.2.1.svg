<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="938.4px" preserveAspectRatio="none" style="width:1077px;height:938px;" version="1.1" viewBox="0 0 1077 938" width="1077px" zoomAndPan="magnify"><defs><filter height="300%" id="fuo4d86gvd023" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.2000000476837158"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.4000000953674316" dy="2.4000000953674316" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="8.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="249.6" x="414.3" y="14.1211">6.1.2. closeSettlementWindow POST: /settlementWindows</text><rect fill="#FFB6C1" height="911.4891" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="67.2" x="39" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="48.6" x="48.3" y="28.234">Central HUB</text><rect fill="#90EE90" height="911.4891" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="503.7" x="287.1" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="501.75" y="28.234">Settlement Service</text><rect fill="#FFFFE0" height="911.4891" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="68.4" x="921.6" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="923.4" y="28.234">Central Services</text><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="17.5863" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="185.0766"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="87.1043" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="611.1621"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="136.077" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="724.8258"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="408.4992" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="487.2" y="202.6629"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="504.5766" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="751.2" y="220.2492"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="952.8" y="276.0082"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="952.8" y="385.1262"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="952.8" y="501.0715"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="777.5168" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1062.6" x="7.8" y="92.5723"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="636.4535" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1050.6" x="13.8" y="229.4356"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="332.7539" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="350.4" x="708" y="244.0219"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="231" x="714" y="332.5535"/><rect fill="#FFFFFF" height="162.6363" style="stroke: none; stroke-width: 0.6000000238418579;" width="1050.6" x="13.8" y="703.2528"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="72.6" x2="72.6" y1="82.3723" y2="880.2891"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="336.3" x2="336.3" y1="82.3723" y2="880.2891"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="489.9" x2="489.9" y1="82.3723" y2="880.2891"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="754.2" x2="754.2" y1="82.3723" y2="880.2891"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="955.8" x2="955.8" y1="82.3723" y2="880.2891"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="41.4" y="80.6004">Hub Employee</text><ellipse cx="72.6" cy="38.2793" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M72.6,43.0793 L72.6,59.2793 M64.8,47.8793 L80.4,47.8793 M72.6,59.2793 L64.8,68.2793 M72.6,59.2793 L80.4,68.2793 " fill="none" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="58.8" x="41.4" y="887.8102">Hub Employee</text><ellipse cx="72.6" cy="895.5821" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M72.6,900.3821 L72.6,916.5821 M64.8,905.1821 L80.4,905.1821 M72.6,916.5821 L64.8,925.5821 M72.6,916.5821 L80.4,925.5821 " fill="none" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="289.5" y="80.6004">Settlement Service API</text><path d="M324.3,55.6793 L324.3,70.0793 M324.3,62.8793 L334.5,62.8793 " fill="none" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="341.7" cy="62.8793" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="90.6" x="289.5" y="887.8102">Settlement Service API</text><path d="M324.3,891.9821 L324.3,906.3821 M324.3,899.1821 L334.5,899.1821 " fill="none" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="341.7" cy="899.1821" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="449.1" y="80.6004">Settlement Window</text><ellipse cx="490.2" cy="62.8793" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="487.8,55.6793,491.4,52.6793,490.2,55.6793,491.4,58.6793,487.8,55.6793" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="449.1" y="887.8102">Settlement Window</text><ellipse cx="490.2" cy="899.1821" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="487.8,891.9821,491.4,888.9821,490.2,891.9821,491.4,894.9821,487.8,891.9821" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="720" y="80.6004">Settlement DAO</text><ellipse cx="754.2" cy="62.8793" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="747" x2="761.4" y1="71.2793" y2="71.2793"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="64.8" x="720" y="887.8102">Settlement DAO</text><ellipse cx="754.2" cy="899.1821" fill="#FEFECE" filter="url(#fuo4d86gvd023)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><line style="stroke: #A80036; stroke-width: 1.2000000476837158;" x1="747" x2="761.4" y1="907.5821" y2="907.5821"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="927" y="80.6004">Central Store</text><path d="M945,50.8793 C945,44.8793 955.8,44.8793 955.8,44.8793 C955.8,44.8793 966.6,44.8793 966.6,50.8793 L966.6,66.4793 C966.6,72.4793 955.8,72.4793 955.8,72.4793 C955.8,72.4793 945,72.4793 945,66.4793 L945,50.8793 " fill="#FEFECE" filter="url(#fuo4d86gvd023)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M945,50.8793 C945,56.8793 955.8,56.8793 955.8,56.8793 C955.8,56.8793 966.6,56.8793 966.6,50.8793 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="54" x="927" y="887.8102">Central Store</text><path d="M945,895.5821 C945,889.5821 955.8,889.5821 955.8,889.5821 C955.8,889.5821 966.6,889.5821 966.6,895.5821 L966.6,911.1821 C966.6,917.1821 955.8,917.1821 955.8,917.1821 C955.8,917.1821 945,917.1821 945,911.1821 L945,895.5821 " fill="#FEFECE" filter="url(#fuo4d86gvd023)" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><path d="M945,895.5821 C945,901.5821 955.8,901.5821 955.8,901.5821 C955.8,901.5821 966.6,901.5821 966.6,895.5821 " fill="none" style="stroke: #000000; stroke-width: 0.9000000357627869;"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="17.5863" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="185.0766"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="87.1043" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="611.1621"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="136.077" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="333.6" y="724.8258"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="408.4992" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="487.2" y="202.6629"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="504.5766" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="751.2" y="220.2492"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="952.8" y="276.0082"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="952.8" y="385.1262"/><rect fill="#FFFFFF" filter="url(#fuo4d86gvd023)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="952.8" y="501.0715"/><path d="M7.8,92.5723 L189.6,92.5723 L189.6,96.7723 L183.6,102.7723 L7.8,102.7723 L7.8,92.5723 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="777.5168" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1062.6" x="7.8" y="92.5723"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="154.8" x="16.8" y="100.7133">Request closure of Settlement Window</text><path d="M75.6,105.9586 L75.6,166.5586 L221.4,166.5586 L221.4,111.9586 L215.4,105.9586 L75.6,105.9586 " fill="#FFFF00" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M215.4,105.9586 L215.4,111.9586 L221.4,111.9586 L215.4,105.9586 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="124.2" x="79.2" y="116.4996">POST:: '/settlementWindows/{id}'</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="81.6" y="125.6859"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="79.2" y="134.8723">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="62.4" x="84" y="144.0586">"state": "closed",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="128.4" x="84" y="153.2449">"reason": "motivation for closure."</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="79.2" y="162.4313">}</text><polygon fill="#A80036" points="326.4,182.6766,332.4,185.0766,326.4,187.4766,328.8,185.0766" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="72.6" x2="330" y1="185.0766" y2="185.0766"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="76.8" y="182.4176">1</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="241.8" x="84.6" y="182.4176">API call Settlement Service to close specified settlement window</text><polygon fill="#A80036" points="480,200.2629,486,202.6629,480,205.0629,482.4,202.6629" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="336.6" x2="483.6" y1="202.6629" y2="202.6629"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="340.8" y="200.0039">2</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="94.8" x="348.6" y="200.0039">Close settlement window</text><polygon fill="#A80036" points="744,217.8492,750,220.2492,744,222.6492,746.4,220.2492" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="493.2" x2="747.6" y1="220.2492" y2="220.2492"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="497.4" y="217.5902">3</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="238.8" x="505.2" y="217.5902">Close settlementWindow&lt;id&gt; and open new settlementWindow</text><path d="M13.8,229.4356 L51,229.4356 L51,233.6356 L45,239.6356 L13.8,239.6356 L13.8,229.4356 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="636.4535" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="1050.6" x="13.8" y="229.4356"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.2" x="22.8" y="237.5766">alt</text><path d="M708,244.0219 L807,244.0219 L807,248.2219 L801,254.2219 L708,254.2219 L708,244.0219 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="332.7539" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="350.4" x="708" y="244.0219"/><text fill="#0000FF" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="717" y="252.1629">DB TRANSACTION</text><polygon fill="#A80036" points="945.6,273.6082,951.6,276.0082,945.6,278.4082,948,276.0082" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="757.2" x2="949.2" y1="276.0082" y2="276.0082"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="761.4" y="268.9424">4</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="171" x="769.2" y="264.3492">Get state for settlementWindow&lt;id&gt; from DB</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="769.2" y="273.5356">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="815.4" y="273.5356">2001</text><polygon fill="#FFFFE0" filter="url(#fuo4d86gvd023)" points="896.4,302.1809,1015.2,302.1809,1021.2,313.5809,1015.2,324.9809,896.4,324.9809,890.4,313.5809,896.4,302.1809" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="69.6" x="897.6" y="312.1219">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="116.4" x="897.6" y="321.3082">settlementWindowStateChange</text><path d="M714,332.5535 L829.8,332.5535 L829.8,336.7535 L823.8,342.7535 L714,342.7535 L714,332.5535 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="231" x="714" y="332.5535"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88.8" x="723" y="340.6945">Validate window state</text><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="757.2" x2="782.4" y1="355.7262" y2="355.7262"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="782.4" x2="782.4" y1="355.7262" y2="363.5262"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="757.8" x2="782.4" y1="363.5262" y2="363.5262"/><polygon fill="#A80036" points="763.8,361.1262,757.8,363.5262,763.8,365.9262,761.4,363.5262" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="761.4" y="352.8809">5</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="168.6" x="769.2" y="352.8809">Validate settlementWindowStateId == 'OPEN'</text><polygon fill="#A80036" points="945.6,382.7262,951.6,385.1262,945.6,387.5262,948,385.1262" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="757.2" x2="949.2" y1="385.1262" y2="385.1262"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="761.4" y="382.4672">6</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="169.8" x="769.2" y="382.4672">Insert settlementWindowStateId == 'CLOSED'</text><path d="M859.2,411.1125 L859.2,426.1125 L1050,426.1125 L1050,417.1125 L1044,411.1125 L859.2,411.1125 " fill="#FFB6C1" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M1044,411.1125 L1044,417.1125 L1050,417.1125 L1044,411.1125 " fill="#FFB6C1" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="18" x="862.8" y="421.6535">Lock</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="883.2" y="421.6535">settlementWindowStateChange</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="29.4" x="1011.6" y="421.6535">for read</text><polygon fill="#FFFFE0" filter="url(#fuo4d86gvd023)" points="896.4,434.6988,1015.2,434.6988,1021.2,446.0988,1015.2,457.4988,896.4,457.4988,890.4,446.0988,896.4,434.6988" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="69.6" x="897.6" y="444.6399">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="116.4" x="897.6" y="453.8262">settlementWindowStateChange</text><polygon fill="#A80036" points="945.6,498.6715,951.6,501.0715,945.6,503.4715,948,501.0715" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="757.2" x2="949.2" y1="501.0715" y2="501.0715"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="761.4" y="484.592">7</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="113.4" x="769.2" y="470.8125">Create new settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="771.6" y="479.9988">state == 'open'</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="148.8" x="771.6" y="489.1852">reason == 'motivation for new Window'</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="769.2" y="498.3715">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="815.4" y="498.3715">2001</text><polygon fill="#FFFFE0" filter="url(#fuo4d86gvd023)" points="896.4,527.0168,1015.2,527.0168,1021.2,538.4168,1015.2,549.8168,896.4,549.8168,890.4,538.4168,896.4,527.0168" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="69.6" x="897.6" y="536.9578">settlementWindow</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="116.4" x="897.6" y="546.1442">settlementWindowStateChange</text><path d="M870.6,556.1895 L870.6,571.1895 L1038,571.1895 L1038,562.1895 L1032,556.1895 L870.6,556.1895 " fill="#FFB6C1" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M1032,556.1895 L1032,562.1895 L1038,562.1895 L1032,556.1895 " fill="#FFB6C1" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="26.4" x="874.2" y="566.7305">Unlock</text><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="903" y="566.7305">settlementWindowStateChange</text><polygon fill="#A80036" points="499.8,591.1758,493.8,593.5758,499.8,595.9758,497.4,593.5758" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="496.2" x2="750.6" y1="593.5758" y2="593.5758"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="503.4" y="590.9168">8</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="176.4" x="511.2" y="590.9168">Successful update for settlementWindow to DB</text><polygon fill="#A80036" points="346.2,608.7621,340.2,611.1621,346.2,613.5621,343.8,611.1621" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="342.6" x2="489.6" y1="611.1621" y2="611.1621"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="349.8" y="608.5031">9</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="128.4" x="357.6" y="608.5031">Operation successfully completed</text><path d="M226.8,619.1485 L226.8,679.7485 L328.2,679.7485 L328.2,625.1485 L322.2,619.1485 L226.8,619.1485 " fill="#FFFF00" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M322.2,619.1485 L322.2,625.1485 L328.2,625.1485 L322.2,619.1485 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="230.4" y="629.6895">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="25.2" x="235.2" y="638.8758">"id": 0,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="66.6" x="235.2" y="648.0621">"reason": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="60" x="235.2" y="657.2485">"state": "string",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="84" x="235.2" y="666.4348">"createdDate": "string"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="230.4" y="675.6211">}</text><polygon fill="#A80036" points="79.2,695.8664,73.2,698.2664,79.2,700.6664,76.8,698.2664" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="75.6" x2="336" y1="698.2664" y2="698.2664"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="82.8" y="695.6074">10</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="96" y="695.6074">Return results</text><line style="stroke: #000000; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="13.8" x2="1064.4" y1="703.8528" y2="703.8528"/><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="16.8" y="710.2336">[</text><text fill="#FF0000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="19.2" y="710.2336">Settlement Window not found or Settlement Window not 'open'</text><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="229.2" y="710.2336">]</text><polygon fill="#A80036" points="346.2,722.4258,340.2,724.8258,346.2,727.2258,343.8,724.8258" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="342.6" x2="753.6" y1="724.8258" y2="724.8258"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="349.8" y="722.1668">11</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="170.4" x="363" y="722.1668">settlement window not found - return ERROR</text><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="339.6" x2="364.8" y1="742.5985" y2="742.5985"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="364.8" x2="364.8" y1="742.5985" y2="750.3985"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="340.2" x2="364.8" y1="750.3985" y2="750.3985"/><polygon fill="#A80036" points="346.2,747.9985,340.2,750.3985,346.2,752.7985,343.8,750.3985" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="343.8" y="739.7532">12</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="63.6" x="357" y="739.7532">Update Event log</text><path d="M342.6,758.1985 L342.6,782.1985 L466.8,782.1985 L466.8,764.1985 L460.8,758.1985 L342.6,758.1985 " fill="#ADD8E6" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M460.8,758.1985 L460.8,764.1985 L466.8,764.1985 L460.8,758.1985 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="82.2" x="346.2" y="768.7395">Log ERROR Messages.</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="111.6" x="346.2" y="777.9258">Update Event log with ERROR.</text><path d="M19.8,790.9711 L19.8,842.5711 L328.2,842.5711 L328.2,796.9711 L322.2,790.9711 L19.8,790.9711 " fill="#FFFF00" filter="url(#fuo4d86gvd023)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M322.2,790.9711 L322.2,796.9711 L328.2,796.9711 L322.2,790.9711 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="23.4" y="801.5121">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="41.4" x="28.2" y="810.6985">"status": 0,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="281.4" x="37.8" y="819.8848">"code": "(ERROR response code eg. '404' - Defined in swagger definition))",</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="72" x="37.8" y="829.0711">"message": "string"</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="23.4" y="838.2575">}</text><polygon fill="#A80036" points="79.2,858.5028,73.2,860.9028,79.2,863.3028,76.8,860.9028" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="75.6" x2="336" y1="860.9028" y2="860.9028"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.8" x="82.8" y="858.2438">13</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="51.6" x="96" y="858.2438">Return ERROR</text><!--
@startuml
title 6.1.2. closeSettlementWindow POST: /settlementWindows

autonumber



actor "Hub Employee" as OPERATOR

boundary "Settlement Service API" as SSAPI
control "Settlement Window" as SETTLEWINDOW
entity "Settlement DAO" as SETTLE_DAO

database "Central Store" as DB

box "Central HUB" #LightPink
    participant OPERATOR
end box

box "Settlement Service" #LightGreen
    participant SSAPI
    participant SETTLEWINDOW
    participant SETTLE_DAO
end box

box "Central Services" #LightYellow
    participant DB
end box


group Request closure of Settlement Window
    note right of OPERATOR #Yellow
        POST:: '/settlementWindows/{id}'

        {
          "state": "closed",
          "reason": "motivation for closure."
        }
    end note
    OPERATOR -> SSAPI: API call Settlement Service to close specified settlement window
    activate SSAPI
    SSAPI -> SETTLEWINDOW: Close settlement window
    deactivate SSAPI
    activate SETTLEWINDOW
        SETTLEWINDOW -> SETTLE_DAO: Close settlementWindow<id> and open new settlementWindow
    alt
        activate SETTLE_DAO
        group <color #blue>DB TRANSACTION</color>
            SETTLE_DAO -> DB: Get state for settlementWindow<id> from DB \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
            hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
            end hnote
            deactivate DB
            group Validate window state
                SETTLE_DAO <- -> SETTLE_DAO: Validate settlementWindowStateId == 'OPEN'
            end
                SETTLE_DAO -> DB: Insert settlementWindowStateId == 'CLOSED'
                note over DB #Lightpink
                Lock **settlementWindowStateChange** for read
                end note
            activate DB
                hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
                end hnote
            deactivate DB

            SETTLE_DAO -> DB: Create new settlementWindow \n state == 'open'\n reason == 'motivation for new Window' \n<color #FF0000><b>Error code:</b> 2001</color>
            activate DB
                hnote over DB #LightYellow
                settlementWindow
                settlementWindowStateChange
                end hnote
            deactivate DB
                note over DB #Lightpink
                Unlock **settlementWindowStateChange**
                end note
        end
        SETTLEWINDOW <- SETTLE_DAO: Successful update for settlementWindow to DB
    SSAPI <- SETTLEWINDOW: Operation successfully completed
    deactivate SETTLEWINDOW
    activate SSAPI
        note left of SSAPI #Yellow
        {
          "id": 0,
          "reason": "string",
          "state": "string",
          "createdDate": "string"
        }
        end note
    OPERATOR <- SSAPI: Return results
    deactivate SSAPI
    else <color #FF0000><b>Settlement Window not found or Settlement Window not 'open'</b></color>

    SETTLE_DAO -> SSAPI: settlement window not found - return ERROR
    deactivate SETTLE_DAO
    activate SSAPI
    SSAPI -> SSAPI: Update Event log
    note right of SSAPI #LightBlue
        Log ERROR Messages.
        Update Event log with ERROR.
    end note
    note left of SSAPI #Yellow
        {
          "status": 0,
              "code": "(ERROR response code eg. '404' - Defined in swagger definition))",
              "message": "string"
        }
    end note
    OPERATOR <- SSAPI: Return ERROR
    deactivate SSAPI
    end
end
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b29
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>