<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="787.2px" preserveAspectRatio="none" style="width:876px;height:787px;" version="1.1" viewBox="0 0 876 787" width="876.6px" zoomAndPan="magnify"><defs><filter height="300%" id="f1nnvo7pv2ptn1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.2000000476837158"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.4000000953674316" dy="2.4000000953674316" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="8.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176.4" x="350.85" y="14.1211">5.1.1. Notification Handler for Rejections</text><rect fill="#D3D3D3" height="760.1707" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="111.6" x="2.4" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="4.2" y="28.234">Financial Service Providers</text><rect fill="#ADD8E6" height="760.1707" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="144.6" x="168" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94.2" x="193.2" y="28.234">ML API Adapter Service</text><rect fill="#FFFFE0" height="760.1707" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="248.4" x="618.3" y="20.693"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60.6" x="712.2" y="28.234">Central Service</text><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="615.4125" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="237.3" y="98.2652"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="735.6" y="193.8106"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="735.6" y="621.3598"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="817.2" y="134.4516"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="606.4125" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="838.8" x="31.5" y="102.4652"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="82.5316" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="611.7" x="164.4" y="161.8242"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="451.9219" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="738.6" x="37.5" y="252.7559"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="496.5" x="164.4" y="267.3422"/><rect fill="#FFFFFF" height="192.5953" style="stroke: none; stroke-width: 0.6000000238418579;" width="738.6" x="37.5" y="512.0824"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="57.9" x2="57.9" y1="92.2652" y2="719.0778"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="240" x2="240" y1="92.2652" y2="719.0778"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="660.9" x2="660.9" y1="92.2652" y2="719.0778"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="738.3" x2="738.3" y1="92.2652" y2="719.0778"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 5.0,5.0;" x1="819.9" x2="819.9" y1="92.2652" y2="719.0778"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="25.8" x="43.5" y="80.6004">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="22.2" x="45.3" y="90.4934">Payer</text><ellipse cx="58.2" cy="38.2793" fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M58.2,43.0793 L58.2,59.2793 M50.4,47.8793 L66,47.8793 M58.2,59.2793 L50.4,68.2793 M58.2,59.2793 L66,68.2793 " fill="none" filter="url(#f1nnvo7pv2ptn1)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="25.8" x="43.5" y="726.5989">DFSP1</text><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="22.2" x="45.3" y="736.4918">Payer</text><ellipse cx="58.2" cy="744.2637" fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" rx="4.8" ry="4.8" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><path d="M58.2,749.0637 L58.2,765.2637 M50.4,753.8637 L66,753.8637 M58.2,765.2637 L50.4,774.2637 M58.2,765.2637 L66,774.2637 " fill="none" filter="url(#f1nnvo7pv2ptn1)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="136.2" x="170.4" y="90.4934">ML API Notification Event Handler</text><ellipse cx="240.3" cy="72.7723" fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="237.9,65.5723,241.5,62.5723,240.3,65.5723,241.5,68.5723,237.9,65.5723" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="136.2" x="170.4" y="726.5989">ML API Notification Event Handler</text><ellipse cx="240.3" cy="737.9707" fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><polygon fill="#A80036" points="237.9,730.7707,241.5,727.7707,240.3,730.7707,241.5,733.7707,237.9,730.7707" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="76.8" x="620.7" y="90.4934">Central Service API</text><path d="M648.6,65.5723 L648.6,79.9723 M648.6,72.7723 L658.8,72.7723 " fill="none" filter="url(#f1nnvo7pv2ptn1)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="666" cy="72.7723" fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="76.8" x="620.7" y="726.5989">Central Service API</text><path d="M648.6,730.7707 L648.6,745.1707 M648.6,737.9707 L658.8,737.9707 " fill="none" filter="url(#f1nnvo7pv2ptn1)" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><ellipse cx="666" cy="737.9707" fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" rx="7.2" ry="7.2" style="stroke: #A80036; stroke-width: 1.2000000476837158;"/><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="58.2" x="709.5" y="68.5723"/><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="58.2" x="707.1" y="70.9723"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="49.8" x="711.3" y="83.2934">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="58.2" x="709.5" y="718.4778"/><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="58.2" x="707.1" y="720.8778"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="49.8" x="711.3" y="733.1989">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="83.4" x="778.5" y="68.5723"/><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="83.4" x="776.1" y="70.9723"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="75" x="780.3" y="83.2934">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="83.4" x="778.5" y="718.4778"/><rect fill="#FEFECE" filter="url(#f1nnvo7pv2ptn1)" height="18.293" style="stroke: #A80036; stroke-width: 0.9000000357627869;" width="83.4" x="776.1" y="720.8778"/><text fill="#000000" font-family="sans-serif" font-size="8.4" lengthAdjust="spacingAndGlyphs" textLength="75" x="780.3" y="733.1989">Notification-Topic</text><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="615.4125" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="237.3" y="98.2652"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="735.6" y="193.8106"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="735.6" y="621.3598"/><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="18" style="stroke: #A80036; stroke-width: 0.6000000238418579;" width="6" x="817.2" y="134.4516"/><path d="M31.5,102.4652 L161.7,102.4652 L161.7,106.6652 L155.7,112.6652 L31.5,112.6652 L31.5,102.4652 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="606.4125" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="838.8" x="31.5" y="102.4652"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103.2" x="40.5" y="110.6063">DFSP Notified of Rejection</text><polygon fill="#A80036" points="810,132.0516,816,134.4516,810,136.8516,812.4,134.4516" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="243.3" x2="813.6" y1="134.4516" y2="134.4516"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="247.5" y="127.3857">1</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="141" x="255.3" y="122.7926">Consume Notification event message</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="257.7" y="131.9789"/><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="257.7" y="131.9789">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="303.9" y="131.9789">2001</text><path d="M164.4,161.8242 L293.4,161.8242 L293.4,166.0242 L287.4,172.0242 L164.4,172.0242 L164.4,161.8242 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="82.5316" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="611.7" x="164.4" y="161.8242"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="173.4" y="169.9652">Persist Event Information</text><polygon fill="#A80036" points="728.4,191.4106,734.4,193.8106,728.4,196.2106,730.8,193.8106" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="243.3" x2="732" y1="193.8106" y2="193.8106"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="247.5" y="186.7447">2</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="97.2" x="255.3" y="182.1516">Publish event information</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="257.7" y="191.3379"/><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="257.7" y="191.3379">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="303.9" y="191.3379">3201</text><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="24.3727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="83.4" x="705.3" y="216.9832"/><polygon fill="#EEEEEE" points="705.3,216.9832,743.7,216.9832,743.7,221.1832,737.7,227.1832,705.3,227.1832,705.3,216.9832" style="stroke: #000000; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="11.4" x="713.1" y="225.7242">ref</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="708.9" y="237.1242">Event Handler {9.1.0}</text><path d="M37.5,252.7559 L74.7,252.7559 L74.7,256.9559 L68.7,262.9559 L37.5,262.9559 L37.5,252.7559 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="451.9219" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="738.6" x="37.5" y="252.7559"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="10.2" x="46.5" y="260.8969">alt</text><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="98.4" x="83.7" y="260.3367">[consume a single messages]</text><path d="M164.4,267.3422 L249.6,267.3422 L249.6,271.5422 L243.6,277.5422 L164.4,277.5422 L164.4,267.3422 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.6000000238418579;"/><rect fill="none" height="35.7727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="496.5" x="164.4" y="267.3422"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.2" x="173.4" y="275.4832">Validate Event</text><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="243.3" x2="268.5" y1="290.5149" y2="290.5149"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="268.5" x2="268.5" y1="290.5149" y2="298.3149"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="243.9" x2="268.5" y1="298.3149" y2="298.3149"/><polygon fill="#A80036" points="249.9,295.9149,243.9,298.3149,249.9,300.7149,247.5,298.3149" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="247.5" y="287.6695">3</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="398.4" x="255.3" y="287.6695">Validate event - Rule: type == 'notification' &amp;&amp; [action IN ['reject', 'timeout-received', 'timeout-reserved']]</text><polygon fill="#A80036" points="653.7,326.5149,659.7,328.9149,653.7,331.3149,656.1,328.9149" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="243.3" x2="657.3" y1="328.9149" y2="328.9149"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="247.5" y="321.849">4</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="135" x="255.3" y="317.2559">Request Participant Callback details</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="257.7" y="326.4422"/><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="257.7" y="326.4422">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="303.9" y="326.4422">3201</text><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="24.3727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="531.9" x="168.6" y="334.0875"/><polygon fill="#EEEEEE" points="168.6,334.0875,207,334.0875,207,338.2875,201,344.2875,168.6,344.2875,168.6,334.0875" style="stroke: #000000; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="11.4" x="176.4" y="342.8285">ref</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="145.2" x="363.15" y="354.2285">Get Participant Callback Details {3.1.0}</text><polygon fill="#A80036" points="249.9,371.6602,243.9,374.0602,249.9,376.4602,247.5,374.0602" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="246.3" x2="660.3" y1="374.0602" y2="374.0602"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="253.5" y="371.4012">5</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="261.3" y="371.4012">Return Participant Callback details</text><path d="M46.2,382.0465 L46.2,479.8465 L231.6,479.8465 L231.6,388.0465 L225.6,382.0465 L46.2,382.0465 " fill="#FFFF00" filter="url(#f1nnvo7pv2ptn1)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M225.6,382.0465 L225.6,388.0465 L231.6,388.0465 L225.6,382.0465 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="34.8" x="49.8" y="392.5875">Message:</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="49.8" y="401.7738">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="34.8" x="59.4" y="410.9602">id: &lt;ID&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="154.8" x="59.4" y="420.1465">from: &lt;transferHeaders.FSPIOP-Source&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="163.2" x="59.4" y="429.3328">to: &lt;transferHeaders.FSPIOP-Destination&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="85.8" x="59.4" y="438.5192">type: application/json,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="36" x="59.4" y="447.7055">content: {</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="108" x="69" y="456.8918">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="4.8" x="59.4" y="466.0781">},</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="49.8" y="475.2645">}</text><polygon fill="#A80036" points="64.8,504.5098,58.8,506.9098,64.8,509.3098,62.4,506.9098" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="61.2" x2="236.7" y1="506.9098" y2="506.9098"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="68.4" y="499.844">6</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="100.2" x="76.2" y="495.2508">Send Callback Notification</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="78.6" y="504.4371"/><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="78.6" y="504.4371">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="67.2" x="124.8" y="504.4371">1000, 1001, 3002</text><line style="stroke: #000000; stroke-width: 0.6000000238418579; stroke-dasharray: 2.0,2.0;" x1="37.5" x2="776.1" y1="512.6824" y2="512.6824"/><text fill="#000000" font-family="sans-serif" font-size="6.6" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="144" x="40.5" y="519.0633">[Validate rule type != 'notification' / Error]</text><path d="M246,524.0555 L246,594.2555 L415.2,594.2555 L415.2,530.0555 L409.2,524.0555 L246,524.0555 " fill="#FFFF00" filter="url(#f1nnvo7pv2ptn1)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M409.2,524.0555 L409.2,530.0555 L415.2,530.0555 L409.2,524.0555 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="34.8" x="249.6" y="534.5965">Message:</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="249.6" y="543.7828">{</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="75.6" x="259.2" y="552.9692">"errorInformation": {</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="99.6" x="268.8" y="562.1555">"errorCode": &lt;errorCode&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="137.4" x="268.8" y="571.3418">"errorDescription": &lt;ErrorMessage&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="259.2" y="580.5281">}</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="2.4" x="249.6" y="589.7145">}</text><polygon fill="#A80036" points="728.4,618.9598,734.4,621.3598,728.4,623.7598,730.8,621.3598" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><line style="stroke: #A80036; stroke-width: 0.6000000238418579;" x1="243.3" x2="732" y1="621.3598" y2="621.3598"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5.4" x="247.5" y="614.294">7</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="205.8" x="255.3" y="609.7008">Invalid messages retrieved from the Notification Topic</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="0" x="257.7" y="618.8871"/><text fill="#FF0000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43.8" x="257.7" y="618.8871">Error code:</text><text fill="#FF0000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="19.2" x="303.9" y="618.8871">3201</text><rect fill="#FFFFFF" filter="url(#f1nnvo7pv2ptn1)" height="24.3727" style="stroke: #000000; stroke-width: 1.2000000476837158;" width="83.4" x="705.3" y="644.5324"/><polygon fill="#EEEEEE" points="705.3,644.5324,743.7,644.5324,743.7,648.7324,737.7,654.7324,705.3,654.7324,705.3,644.5324" style="stroke: #000000; stroke-width: 1.2000000476837158;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="11.4" x="713.1" y="653.2735">ref</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="78.6" x="708.9" y="664.6735">Event Handler {9.1.0}</text><path d="M246,674.9051 L246,698.9051 L417,698.9051 L417,680.9051 L411,674.9051 L246,674.9051 " fill="#ADD8E6" filter="url(#f1nnvo7pv2ptn1)" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><path d="M411,674.9051 L411,680.9051 L417,680.9051 L411,674.9051 " fill="#ADD8E6" style="stroke: #A80036; stroke-width: 0.6000000238418579;"/><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="79.8" x="249.6" y="685.4461">Log ERROR Messages</text><text fill="#000000" font-family="sans-serif" font-size="7.8" lengthAdjust="spacingAndGlyphs" textLength="158.4" x="249.6" y="694.6324">Update Event log upon ERROR notification</text><!--
@startuml
title 5.1.1. Notification Handler for Rejections

autonumber


actor "DFSP1\nPayer" as DFSP1
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Event-Topic" as TOPIC_EVENT
collections "Notification-Topic" as TOPIC_NOTIFICATIONS

box "Financial Service Providers" #lightGray
	participant DFSP1
end box

box "ML API Adapter Service" #LightBlue
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
    participant CSAPI
    participant TOPIC_EVENT
    participant TOPIC_NOTIFICATIONS
end box


group DFSP Notified of Rejection
    activate NOTIFY_HANDLER
        NOTIFY_HANDLER -> TOPIC_NOTIFICATIONS: Consume Notification event message \n <color #FF0000><b>Error code:</b> 2001 </color>
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
            group Persist Event Information
                NOTIFY_HANDLER -> TOPIC_EVENT: Publish event information \n <color #FF0000><b>Error code:</b> 3201 </color>
                activate TOPIC_EVENT
	            ref over TOPIC_EVENT :  Event Handler {9.1.0}
                deactivate TOPIC_EVENT
            end

    alt consume a single messages
        group Validate Event
            NOTIFY_HANDLER <-> NOTIFY_HANDLER: Validate event - Rule: type == 'notification' && [action IN ['reject', 'timeout-received', 'timeout-reserved']]
        end
        NOTIFY_HANDLER -> CSAPI: Request Participant Callback details \n <color #FF0000><b>Error code:</b> 3201 </color>
        ref over NOTIFY_HANDLER, CSAPI: Get Participant Callback Details {3.1.0}
        NOTIFY_HANDLER <- - CSAPI: Return Participant Callback details
        note left of NOTIFY_HANDLER #yellow
            Message:
            {
                id: <ID>,
                from: <transferHeaders.FSPIOP-Source>,
                to: <transferHeaders.FSPIOP-Destination>,
                type: application/json,
                content: {
                    payload: <transferMessage>
                },
            }
        end note
        NOTIFY_HANDLER - -> DFSP1: Send Callback Notification \n <color #FF0000><b>Error code:</b> 1000, 1001, 3002 </color>
    else Validate rule type != 'notification' / Error
        note right of NOTIFY_HANDLER #yellow
            Message:
            {
                "errorInformation": {
                    "errorCode": <errorCode>,
                    "errorDescription": <ErrorMessage>,
                }
            }
        end note
        NOTIFY_HANDLER -> TOPIC_EVENT: Invalid messages retrieved from the Notification Topic \n <color #FF0000><b>Error code:</b> 3201 </color>
        activate TOPIC_EVENT
        deactivate TOPIC_EVENT
        ref over TOPIC_EVENT: Event Handler {9.1.0}
        note right of NOTIFY_HANDLER #lightblue
            Log ERROR Messages
            Update Event log upon ERROR notification
        end note
    end
end
@enduml

PlantUML version 1.2018.01(Sun Jan 28 20:08:22 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1136-b29
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>